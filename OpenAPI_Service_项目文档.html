<!DOCTYPE html>
<html>
<head>
<title>OpenAPI_Service_项目文档.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%F0%9F%93%8B-openapi-service-%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3">📋 OpenAPI Service 项目文档</h1>
<h2 id="%F0%9F%9A%80-%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">🚀 项目概述</h2>
<p>OpenAPI Service是一个基于Spring Boot WebFlux的反应式微服务项目，提供JWT Token认证、API网关代理、请求日志记录等核心功能。项目采用现代化的技术栈，具备高并发、低延迟的特性。</p>
<h3 id="%F0%9F%8E%AF-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7">🎯 核心特性</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>描述</th>
<th>状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>🔐 <strong>JWT认证</strong></td>
<td>基于JWT的Token生成与验证机制</td>
<td>✅ 已实现</td>
</tr>
<tr>
<td>🛡️ <strong>认证拦截器</strong></td>
<td>全链路请求认证与授权控制</td>
<td>✅ 已实现</td>
</tr>
<tr>
<td>📊 <strong>请求日志</strong></td>
<td>完整的请求响应日志记录系统</td>
<td>✅ 已实现</td>
</tr>
<tr>
<td>🌐 <strong>API网关</strong></td>
<td>请求代理与转发功能</td>
<td>✅ 已实现</td>
</tr>
<tr>
<td>💾 <strong>MySQL集成</strong></td>
<td>持久化存储应用凭证管理</td>
<td>✅ 已实现</td>
</tr>
<tr>
<td>🚀 <strong>响应式编程</strong></td>
<td>基于WebFlux的非阻塞IO</td>
<td>✅ 已实现</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%F0%9F%93%8A-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84">📊 技术架构</h2>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-%E6%8A%80%E6%9C%AF%E6%A0%88%E9%85%8D%E7%BD%AE">🛠️ <strong>技术栈配置</strong></h3>
<pre class="hljs"><code><div><span class="hljs-string">框架版本信息：</span>
<span class="hljs-string">┌─────────────────────────────────────────────────────────┐</span>
<span class="hljs-string">│</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Boot</span>      <span class="hljs-string">│</span> <span class="hljs-number">2.7</span><span class="hljs-number">.14</span>                              <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">Spring</span> <span class="hljs-string">WebFlux</span>   <span class="hljs-string">│</span> <span class="hljs-string">响应式Web框架</span>                        <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">JWT</span>              <span class="hljs-string">│</span> <span class="hljs-number">0.11</span><span class="hljs-number">.5</span> <span class="hljs-string">(io.jsonwebtoken)</span>           <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">MySQL</span> <span class="hljs-string">Connector</span>  <span class="hljs-string">│</span> <span class="hljs-number">8.0</span><span class="hljs-number">.33</span>                             <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">JPA/Hibernate</span>    <span class="hljs-string">│</span> <span class="hljs-string">数据持久化</span>                           <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">Java</span> <span class="hljs-string">Version</span>     <span class="hljs-string">│</span> <span class="hljs-number">1.8</span>                                <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">Maven</span>           <span class="hljs-string">│</span> <span class="hljs-string">构建工具</span>                             <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────────────────────────────────────────────┘</span>
</div></code></pre>
<h3 id="%F0%9F%8F%97%EF%B8%8F-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%9B%BE">🏗️ <strong>系统架构图</strong></h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    A[客户端请求] --> B[GlobalWebFilter<br/>全局过滤器]
    B --> C[AuthenticationFilter<br/>认证过滤器]
    C --> D{需要认证?}
    D -->|是| E[JWT验证]
    D -->|否| F[直接通过]
    E --> G{验证通过?}
    G -->|是| H[添加用户信息]
    G -->|否| I[返回401错误]
    H --> J[ServiceController<br/>服务控制器]
    F --> J
    J --> K[RemoteCallService<br/>远程调用服务]
    K --> L[目标API]
    L --> M[返回响应]
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%81-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">📁 项目结构</h2>
<h3 id="%F0%9F%93%82-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3">📂 <strong>目录结构详解</strong></h3>
<pre class="hljs"><code><div>openapi-service/
├── src/main/
│   ├── java/org/openapi/
│   │   ├── 📂 common/          # 公共组件
│   │   │   ├── BaseResponse.java      # 统一响应格式
│   │   │   └── ConstantsHub.java      # 常量定义
│   │   ├── 📂 config/          # 配置类
│   │   │   └── WebFluxConfig.java     # WebFlux配置
│   │   ├── 📂 controller/      # 控制器层
│   │   │   ├── AuthController.java    # 认证接口
│   │   │   ├── HelloServiceController.java  # 测试接口
│   │   │   └── ServiceController.java # 主服务接口
│   │   ├── 📂 dto/             # 数据传输对象
│   │   │   ├── AuthRequest.java       # 认证请求DTO
│   │   │   └── AuthResponse.java      # 认证响应DTO
│   │   ├── 📂 entity/          # 实体类
│   │   │   └── AppCredentials.java    # 应用凭证实体
│   │   ├── 📂 filter/          # 过滤器
│   │   │   ├── AuthenticationFilter.java  # 认证拦截器
│   │   │   └── GlobalWebFilter.java   # 全局过滤器
│   │   ├── 📂 repository/      # 数据访问层
│   │   │   └── AppCredentialsRepository.java
│   │   ├── 📂 service/         # 业务逻辑层
│   │   │   ├── AppService.java        # 应用管理服务
│   │   │   ├── JwtService.java        # JWT工具服务
│   │   │   └── RemoteCallService.java # 远程调用服务
│   │   └── Application.java    # 启动类
│   └── resources/
│       ├── application.yml     # 应用配置
│       ├── data.sql           # 数据库初始化脚本
│       └── logging-config.xml # 日志配置
├── README.md                  # 基础说明文档
├── JWT_API_使用说明.md        # JWT API使用指南
└── pom.xml                    # Maven配置
</div></code></pre>
<hr>
<h2 id="%F0%9F%94%90-%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F">🔐 认证系统</h2>
<h3 id="%F0%9F%8E%AF-jwt-token%E7%AE%A1%E7%90%86">🎯 <strong>JWT Token管理</strong></h3>
<h4 id="%F0%9F%93%8B-token%E7%94%9F%E6%88%90%E6%B5%81%E7%A8%8B">📋 <strong>Token生成流程</strong></h4>
<pre class="hljs"><code><div>Token生成机制：
┌─────────────────────────────────────────────────────────┐
│ <span class="hljs-number">1</span>. 客户端提供 appId + appSecret                         │
│ <span class="hljs-number">2</span>. 数据库验证凭证有效性                                  │
│ <span class="hljs-number">3</span>. 生成<span class="hljs-function">JWT <span class="hljs-title">Token</span> <span class="hljs-params">(HMAC-SHA256)</span>                        │
│ 4. 设置7天有效期 <span class="hljs-params">(<span class="hljs-number">604800</span>秒)</span>                            │
│ 5. 返回完整认证信息                                      │
└─────────────────────────────────────────────────────────┘
</span></div></code></pre>
<h4 id="%F0%9F%94%91-jwt%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0">🔑 <strong>JWT配置参数</strong></h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jwt.secret</code></td>
<td>系统默认密钥</td>
<td>JWT签名密钥(生产环境需修改)</td>
</tr>
<tr>
<td><code>jwt.expiration</code></td>
<td><code>604800</code></td>
<td>Token有效期(7天)</td>
</tr>
<tr>
<td><code>jwt.issuer</code></td>
<td><code>openapi-service</code></td>
<td>Token签发者标识</td>
</tr>
</tbody>
</table>
<h3 id="%F0%9F%9B%A1%EF%B8%8F-%E8%AE%A4%E8%AF%81%E6%8B%A6%E6%88%AA%E5%99%A8%E6%9C%BA%E5%88%B6">🛡️ <strong>认证拦截器机制</strong></h3>
<h4 id="%F0%9F%93%8A-%E8%BF%87%E6%BB%A4%E5%99%A8%E6%89%A7%E8%A1%8C%E9%93%BE">📊 <strong>过滤器执行链</strong></h4>
<pre class="hljs"><code><div>过滤器执行顺序：
┌─────────────────────────────────────────────────────────┐
│ Order: -<span class="hljs-number">1</span>  │ GlobalWebFilter     │ 全局日志+跨域处理   │
│ Order: <span class="hljs-number">0</span>   │ AuthenticationFilter│ JWT认证检查        │
└─────────────────────────────────────────────────────────┘
</div></code></pre>
<h4 id="%F0%9F%94%8D-%E8%AE%A4%E8%AF%81%E7%AD%96%E7%95%A5">🔍 <strong>认证策略</strong></h4>
<ul>
<li><strong>保护路径</strong>: 除 <code>/auth/**</code>（获取token接口） 和 <code>/api/v1/**</code>（服务自身监控检查接口） 外的所有路径</li>
<li><strong>认证方式</strong>: Bearer Token (JWT)</li>
<li><strong>失败处理</strong>: 返回401状态码与错误信息</li>
<li><strong>用户注入</strong>: 成功认证后注入用户信息到请求头</li>
</ul>
<hr>
<h2 id="%F0%9F%93%A1-api%E6%8E%A5%E5%8F%A3%E8%AF%A6%E8%A7%A3">📡 API接口详解</h2>
<h3 id="%F0%9F%94%90-%E8%AE%A4%E8%AF%81%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3">🔐 <strong>认证相关接口</strong></h3>
<h4 id="1-%E7%94%9F%E6%88%90jwt-token">1. <strong>生成JWT Token</strong></h4>
<pre class="hljs"><code><div><span class="hljs-attribute">POST /auth/token
Content-Type</span>: application/json

<span class="json">{
    <span class="hljs-attr">"appId"</span>: <span class="hljs-string">"test-app-001"</span>,
    <span class="hljs-attr">"appSecret"</span>: <span class="hljs-string">"test-secret-001-abcdef123456789"</span>
}
</span></div></code></pre>
<p><strong>响应格式:</strong></p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"result"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"errorMsg"</span>: <span class="hljs-string">"Token生成成功"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"token"</span>: <span class="hljs-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."</span>,
        <span class="hljs-attr">"tokenType"</span>: <span class="hljs-string">"Bearer"</span>,
        <span class="hljs-attr">"expiresIn"</span>: <span class="hljs-number">604800</span>,
        <span class="hljs-attr">"issuedAt"</span>: <span class="hljs-string">"2025-09-20T15:55:00"</span>,
        <span class="hljs-attr">"expiresAt"</span>: <span class="hljs-string">"2025-09-27T15:55:00"</span>,
        <span class="hljs-attr">"appId"</span>: <span class="hljs-string">"test-app-001"</span>,
        <span class="hljs-attr">"appName"</span>: <span class="hljs-string">"测试应用"</span>
    }
}
</div></code></pre>
<h4 id="2-%E9%AA%8C%E8%AF%81jwt-token">2. <strong>验证JWT Token</strong></h4>
<pre class="hljs"><code><div><span class="hljs-attribute">POST /auth/validate?token={JWT_TOKEN}
</span></div></code></pre>
<p><strong>响应格式:</strong></p>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"result"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"errorMsg"</span>: <span class="hljs-string">"Token验证成功"</span>,
    <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"valid"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"appId"</span>: <span class="hljs-string">"test-app-001"</span>,
        <span class="hljs-attr">"appName"</span>: <span class="hljs-string">"测试应用"</span>,
        <span class="hljs-attr">"remainingTime"</span>: <span class="hljs-number">604800</span>,
        <span class="hljs-attr">"nearExpiry"</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">"validatedAt"</span>: <span class="hljs-string">"2025-09-20T15:56:00"</span>
    }
}
</div></code></pre>
<h3 id="%F0%9F%8C%90-api%E4%BB%A3%E7%90%86%E6%8E%A5%E5%8F%A3">🌐 <strong>API代理接口</strong></h3>
<h4 id="%E9%80%9A%E7%94%A8api%E4%BB%A3%E7%90%86"><strong>通用API代理</strong></h4>
<pre class="hljs"><code><div><span class="hljs-attribute">GET|POST|PUT|DELETE /api/**
Headers:
  Authorization</span>: Bearer {JWT_TOKEN}
</div></code></pre>
<ul>
<li><strong>功能</strong>: 将请求代理转发到后端服务</li>
<li><strong>认证</strong>: 必须提供有效的JWT Token</li>
<li><strong>错误处理</strong>: 统一的错误响应格式</li>
</ul>
<hr>
<h2 id="%F0%9F%8C%90-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B7%AF%E7%94%B1%E7%B3%BB%E7%BB%9F">🌐 服务发现与路由系统</h2>
<h3 id="%F0%9F%8E%AF-%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD">🎯 <strong>核心功能</strong></h3>
<p>OpenAPI Service 实现了完整的服务发现和智能路由转发机制，支持微服务架构下的动态服务调用。</p>
<h4 id="%F0%9F%93%8A-%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%9C%BA%E5%88%B6">📊 <strong>服务发现机制</strong></h4>
<table>
<thead>
<tr>
<th>功能</th>
<th>实现方式</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>🔄 <strong>定时发现</strong></td>
<td>ScheduledExecutorService每10分钟更新</td>
<td>自动化服务列表维护</td>
</tr>
<tr>
<td>📋 <strong>服务映射</strong></td>
<td>ConcurrentHashMap存储路径-地址映射</td>
<td>高并发安全访问</td>
</tr>
<tr>
<td>🛡️ <strong>异常保护</strong></td>
<td>Try-catch机制保护主流程</td>
<td>发现失败不影响服务</td>
</tr>
<tr>
<td>🔧 <strong>扩展支持</strong></td>
<td>预留注册中心集成接口</td>
<td>支持Eureka/Nacos对接</td>
</tr>
</tbody>
</table>
<h4 id="%F0%9F%97%BA%EF%B8%8F-%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91%E6%B5%81%E7%A8%8B">🗺️ <strong>路由转发流程</strong></h4>
<pre><code class="language-mermaid"><div class="mermaid">graph TD
    A[客户端请求] --> B[认证通过]
    B --> C[ServiceController接收]
    C --> D[RemoteCallService路由识别]
    D --> E{匹配服务映射?}
    E -->|是| F[路径转换]
    E -->|否| G[返回404错误]
    F --> H[WebClient转发请求]
    H --> I[目标微服务]
    I --> J[响应透传返回]
    G --> K[错误响应]
</div></code></pre>
<hr>
<h2 id="%F0%9F%92%BE-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1">💾 数据库设计</h2>
<h3 id="%F0%9F%93%8A-%E5%BA%94%E7%94%A8%E5%87%AD%E8%AF%81%E8%A1%A8%E7%BB%93%E6%9E%84">📊 <strong>应用凭证表结构</strong></h3>
<pre class="hljs"><code><div><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> app_credentials (
    <span class="hljs-keyword">id</span> <span class="hljs-built_in">BIGINT</span> AUTO_INCREMENT PRIMARY <span class="hljs-keyword">KEY</span>,
    app_id <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">UNIQUE</span>,
    app_secret <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    app_name <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>),
    description <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">500</span>),
    <span class="hljs-keyword">status</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span>,  <span class="hljs-comment">-- 1:启用, 0:禁用</span>
    created_time <span class="hljs-built_in">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>,
    updated_time <span class="hljs-built_in">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span>
);
</div></code></pre>
<h3 id="%F0%9F%94%91-%E9%A2%84%E7%BD%AE%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE">🔑 <strong>预置测试数据</strong></h3>
<table>
<thead>
<tr>
<th>AppId</th>
<th>AppSecret</th>
<th>AppName</th>
<th>状态</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test-app-001</code></td>
<td><code>test-secret-001-abcdef123456789</code></td>
<td>测试应用</td>
<td>启用</td>
</tr>
<tr>
<td><code>demo-app-002</code></td>
<td><code>demo-secret-002-xyz987654321abc</code></td>
<td>演示应用</td>
<td>启用</td>
</tr>
<tr>
<td><code>prod-app-003</code></td>
<td><code>prod-secret-003-secure-long-key</code></td>
<td>生产应用</td>
<td>启用</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="%E2%9A%99%EF%B8%8F-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">⚙️ 配置管理</h2>
<h3 id="%F0%9F%93%9D-applicationyml%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE">📝 <strong>application.yml核心配置</strong></h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 服务基本配置</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9911</span>
  <span class="hljs-attr">max-http-header-size:</span> <span class="hljs-number">10485760</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">demo-Y-hello-service</span>
  
  <span class="hljs-comment"># MySQL数据库配置</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.0.100:3306/openapi_service?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowMultiQueries=true</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">openapi</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">Openapi@4321</span>
    
    <span class="hljs-comment"># HikariCP连接池配置</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">5</span>
      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">20</span>
      <span class="hljs-attr">auto-commit:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">30000</span>
      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">OpenApiHikariCP</span>
      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span>
      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>
      <span class="hljs-attr">connection-test-query:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span>
  
  <span class="hljs-comment"># JPA配置</span>
  <span class="hljs-attr">jpa:</span>
    <span class="hljs-attr">database-platform:</span> <span class="hljs-string">org.hibernate.dialect.MySQL8Dialect</span>
    <span class="hljs-attr">hibernate:</span>
      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">none</span>
    <span class="hljs-attr">show-sql:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">hibernate:</span>
        <span class="hljs-attr">format_sql:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">dialect:</span> <span class="hljs-string">org.hibernate.dialect.MySQL8Dialect</span>
        <span class="hljs-attr">jdbc:</span>
          <span class="hljs-attr">time_zone:</span> <span class="hljs-string">Asia/Shanghai</span>

<span class="hljs-comment"># 日志配置</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">config:</span> <span class="hljs-string">classpath:logging-config.xml</span>
</div></code></pre>
<h3 id="%F0%9F%93%9D-%E6%9C%8D%E5%8A%A1%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">📝 <strong>服务映射配置说明</strong></h3>
<pre class="hljs"><code><div>{
    <span class="hljs-attr">"/api/service-a/**"</span>: <span class="hljs-string">"http://localhost:8081"</span>,
    <span class="hljs-attr">"/api/service-b/**"</span>: <span class="hljs-string">"http://localhost:8082"</span>, 
    <span class="hljs-attr">"/api/service-c/**"</span>: <span class="hljs-string">"http://localhost:8083"</span>,
    <span class="hljs-attr">"/api/user-service/**"</span>: <span class="hljs-string">"http://192.168.1.100:8080"</span>,
    <span class="hljs-attr">"/api/order-service/**"</span>: <span class="hljs-string">"http://192.168.1.101:8080"</span>
}
</div></code></pre>
<hr>
<h2 id="%F0%9F%A7%AA-%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97">🧪 测试指南</h2>
<h3 id="%F0%9F%9A%80-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8">🚀 <strong>快速启动</strong></h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 1. 确保MySQL数据库运行</span>
<span class="hljs-comment"># 2. 创建数据库(如果不存在)</span>
CREATE DATABASE gateway_crud;

<span class="hljs-comment"># 3. 启动应用</span>
mvn spring-boot:run

<span class="hljs-comment"># 4. 验证服务状态</span>
curl http://localhost:9911/<span class="hljs-built_in">test</span>/public
</div></code></pre>
<h3 id="%F0%9F%93%8A-api%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">📊 <strong>API测试用例</strong></h3>
<h4 id="%E6%B5%8B%E8%AF%95token%E7%94%9F%E6%88%90"><strong>测试Token生成</strong></h4>
<pre class="hljs"><code><div>curl -X POST http://localhost:9911/auth/token \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "appId": "test-app-001",
    "appSecret": "test-secret-001-abcdef123456789"
  }'</span>
</div></code></pre>
<h4 id="%E6%B5%8B%E8%AF%95%E8%AE%A4%E8%AF%81%E6%8E%A5%E5%8F%A3"><strong>测试认证接口</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 使用生成的Token测试</span>
curl -X GET http://localhost:9911/api/v1/users \
  -H <span class="hljs-string">"Authorization: Bearer YOUR_JWT_TOKEN"</span>
</div></code></pre>
<h4 id="%E6%B5%8B%E8%AF%95token%E9%AA%8C%E8%AF%81"><strong>测试Token验证</strong></h4>
<pre class="hljs"><code><div>curl -X POST <span class="hljs-string">"http://localhost:9911/auth/validate?token=YOUR_JWT_TOKEN"</span>
</div></code></pre>
<hr>
<h2 id="%F0%9F%93%88-%E6%80%A7%E8%83%BD%E4%B8%8E%E7%9B%91%E6%8E%A7">📈 性能与监控</h2>
<h3 id="%F0%9F%93%8A-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87">📊 <strong>性能指标</strong></h3>
<pre class="hljs"><code><div><span class="hljs-string">预期性能指标：</span>
<span class="hljs-string">┌─────────────────────────────────────────┐</span>
<span class="hljs-string">│</span> <span class="hljs-string">Token生成</span>     <span class="hljs-string">│</span> <span class="hljs-string">平均响应时间:</span> <span class="hljs-number">5</span><span class="hljs-string">-15ms</span>    <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">Token验证</span>     <span class="hljs-string">│</span> <span class="hljs-string">平均响应时间:</span> <span class="hljs-number">2</span><span class="hljs-string">-8ms</span>     <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">API代理</span>       <span class="hljs-string">│</span> <span class="hljs-string">平均响应时间:</span> <span class="hljs-number">10</span><span class="hljs-string">-50ms</span>   <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">数据库查询</span>    <span class="hljs-string">│</span> <span class="hljs-string">平均响应时间:</span> <span class="hljs-number">1</span><span class="hljs-string">-5ms</span>     <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">并发支持</span>      <span class="hljs-string">│</span> <span class="hljs-string">理论支持:</span> <span class="hljs-number">1000</span><span class="hljs-string">+</span> <span class="hljs-string">TPS</span>     <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────────────────────────────┘</span>
</div></code></pre>
<h3 id="%F0%9F%93%9D-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F">📝 <strong>日志系统</strong></h3>
<h4 id="%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB%E9%85%8D%E7%BD%AE"><strong>日志级别配置</strong></h4>
<ul>
<li><strong>INFO</strong>: 正常业务流程记录</li>
<li><strong>WARN</strong>: 认证失败、异常状况</li>
<li><strong>ERROR</strong>: 系统错误、异常堆栈</li>
<li><strong>DEBUG</strong>: 调试信息(Token解析等)</li>
</ul>
<h4 id="%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F%E7%A4%BA%E4%BE%8B"><strong>日志格式示例</strong></h4>
<pre class="hljs"><code><div># 请求开始
2025-09-20 15:10:15 request came [2025-09-20 15:10:15][req-123] GET /api/users from 127.0.0.1

# 认证成功
2025-09-20 15:10:15 [req-123]认证成功 - Path: /api/users

# 请求完成
2025-09-20 15:10:15 request done [2025-09-20 15:10:15][req-123] GET /api/users - Status: 200 OK - Duration: 45ms
</div></code></pre>
<hr>
<h2 id="%F0%9F%9B%A1%EF%B8%8F-%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4">🛡️ 安全防护</h2>
<h3 id="%F0%9F%94%90-%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6">🔐 <strong>安全机制</strong></h3>
<pre class="hljs"><code><div><span class="hljs-string">安全保障措施：</span>
<span class="hljs-string">┌─────────────────────────────────────────────────────────┐</span>
<span class="hljs-string">│</span> <span class="hljs-string">🔒</span> <span class="hljs-string">JWT签名</span>    <span class="hljs-string">│</span> <span class="hljs-string">HMAC-SHA256算法，密钥长度≥32字符</span>      <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">⏰</span> <span class="hljs-string">Token时效</span>  <span class="hljs-string">│</span> <span class="hljs-number">7</span><span class="hljs-string">天有效期，防止长期滥用</span>               <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">🔍</span> <span class="hljs-string">请求验证</span>   <span class="hljs-string">│</span> <span class="hljs-string">签名验证、过期检查、格式校验</span>           <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">📊</span> <span class="hljs-string">凭证管控</span>   <span class="hljs-string">│</span> <span class="hljs-string">数据库存储，支持启用/禁用状态</span>          <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">🛡️</span> <span class="hljs-string">跨域保护</span>   <span class="hljs-string">│</span> <span class="hljs-string">CORS配置，支持预检请求</span>               <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">📝</span> <span class="hljs-string">日志审计</span>   <span class="hljs-string">│</span> <span class="hljs-string">完整的认证日志记录系统</span>               <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────────────────────────────────────────────┘</span>
</div></code></pre>
<h3 id="%E2%9A%A0%EF%B8%8F-%E5%AE%89%E5%85%A8%E5%BB%BA%E8%AE%AE">⚠️ <strong>安全建议</strong></h3>
<ol>
<li><strong>🔑 生产环境密钥</strong>: 必须修改默认JWT密钥</li>
<li><strong>💾 数据库安全</strong>: 使用强密码，限制数据库访问</li>
<li><strong>🌐 HTTPS部署</strong>: 生产环境必须使用HTTPS</li>
<li><strong>📊 监控告警</strong>: 建立异常认证监控机制</li>
<li><strong>🔄 密钥轮换</strong>: 定期更新JWT签名密钥</li>
</ol>
<hr>
<h2 id="%F0%9F%9A%80-%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97">🚀 部署指南</h2>
<h3 id="%F0%9F%8F%97%EF%B8%8F-%E7%94%9F%E4%BA%A7%E9%83%A8%E7%BD%B2%E5%BB%BA%E8%AE%AE">🏗️ <strong>生产部署建议</strong></h3>
<h4 id="%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82"><strong>环境要求</strong></h4>
<pre class="hljs"><code><div><span class="hljs-string">生产环境配置：</span>
<span class="hljs-string">┌─────────────────────────────────────────┐</span>
<span class="hljs-string">│</span> <span class="hljs-string">Java</span> <span class="hljs-string">Version</span>  <span class="hljs-string">│</span> <span class="hljs-number">1.8</span><span class="hljs-string">+</span>                   <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">Memory</span>        <span class="hljs-string">│</span> <span class="hljs-string">最小2GB，推荐4GB+</span>       <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">CPU</span>           <span class="hljs-string">│</span> <span class="hljs-string">最小2核，推荐4核+</span>       <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">MySQL</span>         <span class="hljs-string">│</span> <span class="hljs-number">5.7</span><span class="hljs-string">+</span> <span class="hljs-string">或</span> <span class="hljs-number">8.0</span><span class="hljs-string">+</span>          <span class="hljs-string">│</span>
<span class="hljs-string">│</span> <span class="hljs-string">Network</span>       <span class="hljs-string">│</span> <span class="hljs-string">千兆网络</span>               <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────────────────────────────┘</span>
</div></code></pre>
<h4 id="%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><strong>部署步骤</strong></h4>
<pre class="hljs"><code><div><span class="hljs-comment"># 1. 构建应用</span>
mvn clean package -DskipTests

<span class="hljs-comment"># 2. 配置生产环境变量</span>
<span class="hljs-built_in">export</span> JWT_SECRET=<span class="hljs-string">"your-super-secure-jwt-secret-key-for-production"</span>
<span class="hljs-built_in">export</span> DB_URL=<span class="hljs-string">"jdbc:mysql://prod-db:3306/openapi_service"</span>
<span class="hljs-built_in">export</span> DB_USERNAME=<span class="hljs-string">"openapi_user"</span>
<span class="hljs-built_in">export</span> DB_PASSWORD=<span class="hljs-string">"secure_password"</span>

<span class="hljs-comment"># 3. 启动应用</span>
java -jar -Xms2g -Xmx4g -Dspring.profiles.active=prod target/service-0.0.1-SNAPSHOT.jar
</div></code></pre>
<h3 id="%F0%9F%93%8A-%E7%9B%91%E6%8E%A7%E9%85%8D%E7%BD%AE">📊 <strong>监控配置</strong></h3>
<pre class="hljs"><code><div><span class="hljs-comment"># 添加到application.yml</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,info,metrics,prometheus</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-attr">show-details:</span> <span class="hljs-string">always</span>
</div></code></pre>
<hr>
<h2 id="%F0%9F%94%A7-%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97">🔧 开发指南</h2>
<h3 id="%F0%9F%92%A1-%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%E5%BB%BA%E8%AE%AE">💡 <strong>扩展功能建议</strong></h3>
<ol>
<li><strong>🔄 Token刷新</strong>: 实现Token自动刷新机制</li>
<li><strong>👥 用户管理</strong>: 添加用户CRUD管理接口</li>
<li><strong>📊 API统计</strong>: 增加API调用统计功能</li>
<li><strong>🚦 限流控制</strong>: 实现请求频率限制</li>
<li><strong>🔍 链路追踪</strong>: 集成分布式链路追踪</li>
</ol>
<h3 id="%F0%9F%8E%AF-%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83">🎯 <strong>代码规范</strong></h3>
<ul>
<li><strong>📝 注释</strong>: 所有公共方法必须有JavaDoc注释</li>
<li><strong>🔧 异常处理</strong>: 统一的异常处理机制</li>
<li><strong>📊 日志规范</strong>: 使用结构化日志格式</li>
<li><strong>🧪 单元测试</strong>: 核心业务逻辑必须有单元测试</li>
</ul>
<hr>
<h2 id="%F0%9F%93%9E-%E8%81%94%E7%B3%BB%E4%BF%A1%E6%81%AF">📞 联系信息</h2>
<h3 id="%F0%9F%9B%A0%EF%B8%8F-%E7%BB%B4%E6%8A%A4%E5%9B%A2%E9%98%9F">🛠️ <strong>维护团队</strong></h3>
<ul>
<li><strong>项目负责人</strong>: OpenAPI Team</li>
<li><strong>技术栈</strong>: Spring Boot + WebFlux + JWT + MySQL</li>
<li><strong>更新频率</strong>: 持续集成与部署</li>
</ul>
<h3 id="%F0%9F%93%9A-%E7%9B%B8%E5%85%B3%E6%96%87%E6%A1%A3">📚 <strong>相关文档</strong></h3>
<ul>
<li><code>README.md</code>: 基础说明文档</li>
<li><code>JWT_API_使用说明.md</code>: JWT API详细使用指南</li>
<li>本文档: 完整项目架构与使用文档</li>
</ul>
<hr>
<h2 id="%F0%9F%93%8B-%E7%89%88%E6%9C%AC%E8%AE%B0%E5%BD%95">📋 版本记录</h2>
<table>
<thead>
<tr>
<th>版本</th>
<th>日期</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>v0.0.1</td>
<td>2025-09-14</td>
<td>初始版本，基础JWT认证功能</td>
</tr>
<tr>
<td>v0.0.2</td>
<td>2025-09-17</td>
<td>完善认证拦截器，增加MySQL支持</td>
</tr>
<tr>
<td>v0.0.3</td>
<td>2025-09-20</td>
<td>优化日志系统，完善API文档</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>🎉 感谢使用 OpenAPI Service！</strong></p>
<p><em>如有问题，请参考相关文档或联系开发团队。</em></p>

</body>
</html>
